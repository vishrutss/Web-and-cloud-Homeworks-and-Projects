{% extends "layout.html" %}
{% block content %}
    <h2>Movie Trailer Viewer</h2>

    <h3>display favourites <a href="{{ url_for('favourites') }}">here</a></h3>

    <form action="{{ url_for('index') }}" method="GET">
  	<input type="text" name="query" placeholder="Search for movies">
  	<button type="submit">Search</button>
    </form>

    <h2>Movie Details</h2>
    <ul>
        {% for movie in movies %}
        <li>
		<a href="{{ url_for('display', movie_id=movie.id) }}">{{ movie.title }}</a>
		<button onclick="addToFavorites('{{ movie.id }}', '{{ movie.title }}', '{{ movie.overview }}', '{{ movie.original_language }}')">Add to Favorites</button>
	</li>
        {% endfor %}
    </ul>
    <script>
  	function addToFavorites(movieId, movieTitle, movieOverview, movieLanguage) {
    		var xhr = new XMLHttpRequest();
    		xhr.open("POST", "/submit", true);
    		xhr.setRequestHeader("Content-Type", "application/json");
    		xhr.onreadystatechange = function() {
      			if (xhr.readyState === 4 && xhr.status === 200) {
        			alert("Movie added to favorites");
      			}
    		};
    		var data = JSON.stringify({
      			movie_id: movieId,
      			title: movieTitle,
      			overview: movieOverview,
      			language: movieLanguage
    		});
    		xhr.send(data);
  	}
    </script>
{% endblock %}
